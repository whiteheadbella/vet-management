{% extends "base.html" %}

{% block title %}{{ record.pet_name }} - Health Record{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <a href="/health-records" class="btn btn-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Back to Records
        </a>
        <h2>
            <i class="bi bi-{{ 'dog' if record.species == 'dog' else 'cat' }}"></i>
            {{ record.pet_name }} - Health Record
        </h2>
    </div>
</div>

<div class="row">
    <!-- Basic Information -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Basic Information</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <th>Pet ID:</th>
                        <td>{{ record.pet_id }}</td>
                    </tr>
                    <tr>
                        <th>Name:</th>
                        <td>{{ record.pet_name }}</td>
                    </tr>
                    <tr>
                        <th>Species:</th>
                        <td>{{ record.species.title() }}</td>
                    </tr>
                    <tr>
                        <th>Breed:</th>
                        <td>{{ record.breed or 'Unknown' }}</td>
                    </tr>
                    <tr>
                        <th>Microchip:</th>
                        <td>{{ record.microchip_number or 'Not microchipped' }}</td>
                    </tr>
                    <tr>
                        <th>Spayed/Neutered:</th>
                        <td>
                            {% if record.spayed_neutered %}
                                <span class="badge bg-success">Yes</span>
                                {% if record.spay_neuter_date %}
                                    ({{ record.spay_neuter_date.strftime('%Y-%m-%d') }})
                                {% endif %}
                            {% else %}
                                <span class="badge bg-secondary">No</span>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Physical Examination -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-clipboard2-pulse"></i> Physical Examination</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <th>Last Checkup:</th>
                        <td>{{ record.last_checkup.strftime('%Y-%m-%d %H:%M') if record.last_checkup else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <th>Weight:</th>
                        <td>{{ record.weight }} kg</td>
                    </tr>
                    <tr>
                        <th>Temperature:</th>
                        <td>{{ record.temperature }}Â°C</td>
                    </tr>
                    <tr>
                        <th>Heart Rate:</th>
                        <td>{{ record.heart_rate }} bpm</td>
                    </tr>
                    <tr>
                        <th>Respiratory Rate:</th>
                        <td>{{ record.respiratory_rate }} breaths/min</td>
                    </tr>
                    <tr>
                        <th>Body Condition:</th>
                        <td><span class="badge bg-info">{{ record.body_condition_score }}</span></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Vaccination History -->
<div class="card mb-4">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="bi bi-shield-fill-check"></i> Vaccination History</h5>
    </div>
    <div class="card-body">
        {% set vaccinations = record.get_vaccinations() %}
        {% if vaccinations %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Vaccine</th>
                            <th>Date Given</th>
                            <th>Dose</th>
                            <th>Manufacturer</th>
                            <th>Lot Number</th>
                            <th>Administered By</th>
                            <th>Next Due</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vax in vaccinations %}
                        <tr>
                            <td><strong>{{ vax.short_name }}</strong><br><small>{{ vax.vaccine_name }}</small></td>
                            <td>{{ vax.date_given }}</td>
                            <td><span class="badge bg-primary">{{ vax.dose_number }}</span></td>
                            <td>{{ vax.manufacturer }}</td>
                            <td><code>{{ vax.lot_number }}</code></td>
                            <td>{{ vax.administered_by }}</td>
                            <td>
                                {% if vax.next_due %}
                                    <span class="badge bg-info">{{ vax.next_due }}</span>
                                {% else %}
                                    <span class="text-muted">Series in progress</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted">No vaccination records available.</p>
        {% endif %}
    </div>
</div>

<!-- Deworming History -->
<div class="card mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0"><i class="bi bi-capsule"></i> Deworming History</h5>
    </div>
    <div class="card-body">
        {% set deworming = record.get_deworming_records() %}
        {% if deworming %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Product</th>
                            <th>Weight at Treatment</th>
                            <th>Administered By</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dw in deworming %}
                        <tr>
                            <td>{{ dw.date }}</td>
                            <td>{{ dw.product }}</td>
                            <td>{{ dw.weight_at_treatment }} kg</td>
                            <td>{{ dw.administered_by }}</td>
                            <td>{{ dw.notes }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted">No deworming records available.</p>
        {% endif %}
    </div>
</div>

<!-- Preventive Care -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-heart-pulse"></i> Preventive Care</h5>
            </div>
            <div class="card-body">
                <h6>Heartworm</h6>
                <p>
                    Status: <span class="badge bg-{{ 'success' if record.heartworm_status == 'Negative' else 'danger' }}">
                        {{ record.heartworm_status }}
                    </span><br>
                    Last Test: {{ record.heartworm_test_date.strftime('%Y-%m-%d') if record.heartworm_test_date else 'N/A' }}
                </p>

                <h6>Flea & Tick Prevention</h6>
                <p>
                    {% if record.flea_tick_prevention %}
                        Product: <strong>{{ record.flea_tick_product }}</strong><br>
                        Last Applied: {{ record.flea_tick_last_applied.strftime('%Y-%m-%d') if record.flea_tick_last_applied else 'N/A' }}
                    {% else %}
                        <span class="text-muted">Not on prevention</span>
                    {% endif %}
                </p>

                <h6>Dental Health</h6>
                <p>
                    Status: <span class="badge bg-{{ 'success' if record.dental_health in ['Excellent', 'Good'] else 'warning' }}">
                        {{ record.dental_health or 'Not Assessed' }}
                    </span><br>
                    {% if record.dental_cleaning_date %}
                        Last Cleaning: {{ record.dental_cleaning_date.strftime('%Y-%m-%d') }}
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Medical Information</h5>
            </div>
            <div class="card-body">
                <h6>Allergies</h6>
                <p>{{ record.allergies or 'None known' }}</p>

                <h6>Current Medications</h6>
                <p>{{ record.medications or 'None' }}</p>

                <h6>Chronic Conditions</h6>
                <p>{{ record.chronic_conditions or 'None' }}</p>

                <h6>Medical History</h6>
                <p>{{ record.medical_history or 'No significant medical history' }}</p>

                <h6>Surgical History</h6>
                <p>{{ record.surgical_history or 'None' }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Notes -->
{% if record.notes %}
<div class="card mb-4">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0"><i class="bi bi-journal-text"></i> Veterinary Notes</h5>
    </div>
    <div class="card-body">
        <p>{{ record.notes }}</p>
    </div>
</div>
{% endif %}

<!-- Action Buttons -->
<div class="mt-4">
    <a href="/health-records/{{ record.id }}/edit" class="btn btn-primary">
        <i class="bi bi-pencil"></i> Edit Record
    </a>
    <a href="/health-records" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to List
    </a>
    <button onclick="window.print()" class="btn btn-info">
        <i class="bi bi-printer"></i> Print Record
    </button>
</div>
{% endblock %}

{% block scripts %}
<style>
@media print {
    .btn, nav, footer { display: none !important; }
}
</style>
{% endblock %}
